;;; nixos/editors/.doom.d/package_configuration/telega/tests/test_telega.el -*- lexical-binding: t; -*-

(describe "sticker"
  (it "should send to thread"
    (let* ((msg '(:@type "message" :id 45884637184 :sender_id (:@type "messageSenderUser" :user_id 98910262) :chat_id -1001607382841 :is_outgoing t :is_pinned nil :is_from_offline nil :can_be_edited t :can_be_forwarded t :can_be_replied_in_another_chat t :can_be_saved t :can_be_deleted_only_for_self nil :can_be_deleted_for_all_users t :can_get_added_reactions nil :can_get_statistics nil :can_get_message_thread nil :can_get_read_date nil :can_get_viewers t :can_get_media_timestamp_links t :can_report_reactions nil :has_timestamped_media t :is_channel_post nil :is_topic_message t :contains_unread_mention nil :date 1716901713 :edit_date 0 :unread_reactions [] :message_thread_id 31457280 :saved_messages_topic_id 0 :self_destruct_in 0.0 :auto_delete_in 0.0 :via_bot_user_id 0 :sender_business_bot_user_id 0 :sender_boost_count 0 :author_signature "" :media_album_id "0" :restriction_reason "" :content (:@type "messageText" :text (:@type "formattedText" :text "Kappa" :entities [])) :ignored-p nil)))
      (spy-on 'send-sticker :and-call-fake (lambda (stick chat)
					     (expect (plist-get chat :message_thread_id) :not :to-equal 0)
					     (expect (telega-chat-message-thread-id
						       chat nil 'for-send) :not :to-equal 0)
					     ))
      (telega-if-kappa-send-sticker msg)
      (expect 'send-sticker :to-have-been-called)
      )
    )
	(it "should save id to file"
		(let* ((msg '(:@type "message" :id 411889041408 :sender_id (:@type "messageSenderUser" :user_id 98910262) :chat_id 98910262 :is_outgoing t :is_pinned nil :is_from_offline nil :can_be_edited nil :can_be_forwarded t :can_be_replied_in_another_chat t :can_be_saved t :can_be_deleted_only_for_self t :can_be_deleted_for_all_users nil :can_get_added_reactions nil :can_get_statistics nil :can_get_message_thread nil :can_get_read_date nil :can_get_viewers nil :can_get_media_timestamp_links nil :can_report_reactions nil :has_timestamped_media t :is_channel_post nil :is_topic_message nil :contains_unread_mention nil :date 1717004352 :edit_date 0 :unread_reactions [] :message_thread_id 0 :saved_messages_topic_id 98910262 :self_destruct_in 0.0 :auto_delete_in 0.0 :via_bot_user_id 0 :sender_business_bot_user_id 0 :sender_boost_count 0 :author_signature "" :media_album_id "0" :restriction_reason "" :content (:@type "messageSticker" :sticker (:@type "sticker" :id "5251394021045062413" :set_id "424816340528791563" :width 512 :height 512 :emoji #("í ½í¸€" 0 2 (telega-display "ðŸ˜€" telega-emoji-p t)) :format (:@type "stickerFormatWebp") :full_type (:@type "stickerFullTypeRegular") :outline [(:@type "closedVectorPath" :commands [(:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 235.0 :y 511.0) :end_control_point (:@type "point" :x 223.0 :y 518.0) :end_point (:@type "point" :x 222.0 :y 505.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 220.0 :y 495.0) :end_control_point (:@type "point" :x 222.0 :y 429.0) :end_point (:@type "point" :x 214.0 :y 431.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 196.0 :y 435.0) :end_control_point (:@type "point" :x 207.0 :y 473.0) :end_point (:@type "point" :x 205.0 :y 484.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 200.0 :y 512.0) :end_control_point (:@type "point" :x 169.0 :y 515.0) :end_point (:@type "point" :x 164.0 :y 477.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 160.0 :y 451.0) :end_control_point (:@type "point" :x 162.0 :y 424.0) :end_point (:@type "point" :x 159.0 :y 397.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 157.0 :y 380.0) :end_control_point (:@type "point" :x 149.0 :y 366.0) :end_point (:@type "point" :x 146.0 :y 348.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 140.0 :y 310.0) :end_control_point (:@type "point" :x 136.0 :y 206.0) :end_point (:@type "point" :x 146.0 :y 170.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 152.0 :y 149.0) :end_control_point (:@type "point" :x 175.0 :y 143.0) :end_point (:@type "point" :x 188.0 :y 130.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 190.0 :y 129.0) :end_control_point (:@type "point" :x 186.0 :y 128.0) :end_point (:@type "point" :x 185.0 :y 126.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 184.0 :y 123.0) :end_control_point (:@type "point" :x 186.0 :y 118.0) :end_point (:@type "point" :x 186.0 :y 115.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 188.0 :y 107.0) :end_control_point (:@type "point" :x 195.0 :y 106.0) :end_point (:@type "point" :x 199.0 :y 99.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 199.0 :y 98.0) :end_control_point (:@type "point" :x 189.0 :y 83.0) :end_point (:@type "point" :x 188.0 :y 81.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 184.0 :y 68.0) :end_control_point (:@type "point" :x 190.0 :y 37.0) :end_point (:@type "point" :x 201.0 :y 27.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 226.0 :y 3.0) :end_control_point (:@type "point" :x 264.0 :y 28.0) :end_point (:@type "point" :x 270.0 :y 56.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 272.0 :y 69.0) :end_control_point (:@type "point" :x 276.0 :y 59.0) :end_point (:@type "point" :x 278.0 :y 67.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 280.0 :y 73.0) :end_control_point (:@type "point" :x 268.0 :y 83.0) :end_point (:@type "point" :x 273.0 :y 86.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 282.0 :y 91.0) :end_control_point (:@type "point" :x 284.0 :y 95.0) :end_point (:@type "point" :x 291.0 :y 101.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 292.0 :y 102.0) :end_control_point (:@type "point" :x 293.0 :y 106.0) :end_point (:@type "point" :x 294.0 :y 104.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 304.0 :y 91.0) :end_control_point (:@type "point" :x 279.0 :y 67.0) :end_point (:@type "point" :x 334.0 :y 78.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 346.0 :y 80.0) :end_control_point (:@type "point" :x 335.0 :y 114.0) :end_point (:@type "point" :x 338.0 :y 121.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 342.0 :y 126.0) :end_control_point (:@type "point" :x 367.0 :y 151.0) :end_point (:@type "point" :x 367.0 :y 151.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 369.0 :y 160.0) :end_control_point (:@type "point" :x 371.0 :y 166.0) :end_point (:@type "point" :x 377.0 :y 174.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 384.0 :y 182.0) :end_control_point (:@type "point" :x 394.0 :y 189.0) :end_point (:@type "point" :x 399.0 :y 200.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 403.0 :y 207.0) :end_control_point (:@type "point" :x 403.0 :y 219.0) :end_point (:@type "point" :x 402.0 :y 227.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 400.0 :y 277.0) :end_control_point (:@type "point" :x 377.0 :y 243.0) :end_point (:@type "point" :x 358.0 :y 257.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 354.0 :y 259.0) :end_control_point (:@type "point" :x 360.0 :y 281.0) :end_point (:@type "point" :x 356.0 :y 287.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 350.0 :y 298.0) :end_control_point (:@type "point" :x 336.0 :y 294.0) :end_point (:@type "point" :x 340.0 :y 313.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 342.0 :y 319.0) :end_control_point (:@type "point" :x 352.0 :y 322.0) :end_point (:@type "point" :x 352.0 :y 329.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 350.0 :y 363.0) :end_control_point (:@type "point" :x 359.0 :y 384.0) :end_point (:@type "point" :x 365.0 :y 418.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 368.0 :y 436.0) :end_control_point (:@type "point" :x 366.0 :y 455.0) :end_point (:@type "point" :x 370.0 :y 473.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 371.0 :y 476.0) :end_control_point (:@type "point" :x 378.0 :y 510.0) :end_point (:@type "point" :x 375.0 :y 512.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 371.0 :y 514.0) :end_control_point (:@type "point" :x 354.0 :y 512.0) :end_point (:@type "point" :x 349.0 :y 512.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 345.0 :y 512.0) :end_control_point (:@type "point" :x 326.0 :y 515.0) :end_point (:@type "point" :x 323.0 :y 513.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 321.0 :y 511.0) :end_control_point (:@type "point" :x 299.0 :y 441.0) :end_point (:@type "point" :x 294.0 :y 432.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 291.0 :y 426.0) :end_control_point (:@type "point" :x 282.0 :y 392.0) :end_point (:@type "point" :x 279.0 :y 403.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 273.0 :y 428.0) :end_control_point (:@type "point" :x 268.0 :y 457.0) :end_point (:@type "point" :x 268.0 :y 483.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 268.0 :y 485.0) :end_control_point (:@type "point" :x 271.0 :y 512.0) :end_point (:@type "point" :x 270.0 :y 513.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 267.0 :y 515.0) :end_control_point (:@type "point" :x 250.0 :y 513.0) :end_point (:@type "point" :x 247.0 :y 513.0)) (:@type "vectorPathCommandLine" :end_point (:@type "point" :x 246.0 :y 512.0))])] :thumbnail (:@type "thumbnail" :format (:@type "thumbnailFormatWebp") :width 320 :height 320 :file (:@type "file" :id 2353 :size 13818 :expected_size 13818 :local (:@type "localFile" :path "/home/andrew/.telega/thumbnails/5251394021045062413_109.webp" :can_be_downloaded t :can_be_deleted t :is_downloading_active nil :is_downloading_completed t :download_offset 0 :downloaded_prefix_size 13818 :downloaded_size 13818) :remote (:@type "remoteFile" :id "AAMCAgADGQEAAQX-SmZXZep7-PyJHVG4t-oUGZPCAAGcawACDUsAAgqz4EgmuypvxlN2tAEAB20AAzUE" :unique_id "AQADDUsAAgqz4Ehy" :is_uploading_active nil :is_uploading_completed t :uploaded_size 13818) :telega-file-recency 1717004267)) :sticker (:@type "file" :id 2354 :size 24874 :expected_size 24874 :local (:@type "localFile" :path "/home/andrew/.telega/stickers/5251394021045062413.webp" :can_be_downloaded t :can_be_deleted t :is_downloading_active nil :is_downloading_completed t :download_offset 0 :downloaded_prefix_size 24874 :downloaded_size 24874) :remote (:@type "remoteFile" :id "CAACAgIAAxkBAAEF_kpmV2Xqe_j8iR1RuLfqFBmTwgABnGsAAg1LAAIKs-BIJrsqb8ZTdrQ1BA" :unique_id "AgADDUsAAgqz4Eg" :is_uploading_active nil :is_uploading_completed t :uploaded_size 24874) :telega-file-recency 1717004267) :telega-image (image :type png :file "/home/andrew/.telega/stickers/5251394021045062413_telega.png" :height (4.923076923076923 . em) :telega-nslices 4 :scale 1.0 :ascent center :transform-smoothing t :background "#1E2029")) :is_premium nil))))
      (spy-on 'write-region :and-call-fake (lambda (str _ file-path &rest args)
					     (expect str :to-equal "CAACAgIAAxkBAAEF_kpmV2Xqe_j8iR1RuLfqFBmTwgABnGsAAg1LAAIKs-BIJrsqb8ZTdrQ1BA\n")
					     (expect file-path :to-equal "/home/andrew/.telega/sticker.txt")
					     ))
			(expect (telega--tl-get msg :content :sticker :sticker :remote :id) :to-equal "CAACAgIAAxkBAAEF_kpmV2Xqe_j8iR1RuLfqFBmTwgABnGsAAg1LAAIKs-BIJrsqb8ZTdrQ1BA")
      (telega-if-kappa-send-sticker msg)
      (expect 'write-region :to-have-been-called)
			)
		)
	(it "should save id to file!"
		(let* ((msg '(:@type "message" :id 411889041408 :sender_id (:@type "messageSenderUser" :user_id 98910262) :chat_id 98910262 :is_outgoing t :is_pinned nil :is_from_offline nil :can_be_edited nil :can_be_forwarded t :can_be_replied_in_another_chat t :can_be_saved t :can_be_deleted_only_for_self t :can_be_deleted_for_all_users nil :can_get_added_reactions nil :can_get_statistics nil :can_get_message_thread nil :can_get_read_date nil :can_get_viewers nil :can_get_media_timestamp_links nil :can_report_reactions nil :has_timestamped_media t :is_channel_post nil :is_topic_message nil :contains_unread_mention nil :date 1717004352 :edit_date 0 :unread_reactions [] :message_thread_id 0 :saved_messages_topic_id 98910262 :self_destruct_in 0.0 :auto_delete_in 0.0 :via_bot_user_id 0 :sender_business_bot_user_id 0 :sender_boost_count 0 :author_signature "" :media_album_id "0" :restriction_reason "" :content (:@type "messageSticker" :sticker (:@type "sticker" :id "5251394021045062413" :set_id "424816340528791563" :width 512 :height 512 :emoji #("í ½í¸€" 0 2 (telega-display "ðŸ˜€" telega-emoji-p t)) :format (:@type "stickerFormatWebp") :full_type (:@type "stickerFullTypeRegular") :outline [(:@type "closedVectorPath" :commands [(:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 235.0 :y 511.0) :end_control_point (:@type "point" :x 223.0 :y 518.0) :end_point (:@type "point" :x 222.0 :y 505.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 220.0 :y 495.0) :end_control_point (:@type "point" :x 222.0 :y 429.0) :end_point (:@type "point" :x 214.0 :y 431.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 196.0 :y 435.0) :end_control_point (:@type "point" :x 207.0 :y 473.0) :end_point (:@type "point" :x 205.0 :y 484.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 200.0 :y 512.0) :end_control_point (:@type "point" :x 169.0 :y 515.0) :end_point (:@type "point" :x 164.0 :y 477.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 160.0 :y 451.0) :end_control_point (:@type "point" :x 162.0 :y 424.0) :end_point (:@type "point" :x 159.0 :y 397.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 157.0 :y 380.0) :end_control_point (:@type "point" :x 149.0 :y 366.0) :end_point (:@type "point" :x 146.0 :y 348.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 140.0 :y 310.0) :end_control_point (:@type "point" :x 136.0 :y 206.0) :end_point (:@type "point" :x 146.0 :y 170.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 152.0 :y 149.0) :end_control_point (:@type "point" :x 175.0 :y 143.0) :end_point (:@type "point" :x 188.0 :y 130.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 190.0 :y 129.0) :end_control_point (:@type "point" :x 186.0 :y 128.0) :end_point (:@type "point" :x 185.0 :y 126.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 184.0 :y 123.0) :end_control_point (:@type "point" :x 186.0 :y 118.0) :end_point (:@type "point" :x 186.0 :y 115.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 188.0 :y 107.0) :end_control_point (:@type "point" :x 195.0 :y 106.0) :end_point (:@type "point" :x 199.0 :y 99.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 199.0 :y 98.0) :end_control_point (:@type "point" :x 189.0 :y 83.0) :end_point (:@type "point" :x 188.0 :y 81.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 184.0 :y 68.0) :end_control_point (:@type "point" :x 190.0 :y 37.0) :end_point (:@type "point" :x 201.0 :y 27.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 226.0 :y 3.0) :end_control_point (:@type "point" :x 264.0 :y 28.0) :end_point (:@type "point" :x 270.0 :y 56.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 272.0 :y 69.0) :end_control_point (:@type "point" :x 276.0 :y 59.0) :end_point (:@type "point" :x 278.0 :y 67.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 280.0 :y 73.0) :end_control_point (:@type "point" :x 268.0 :y 83.0) :end_point (:@type "point" :x 273.0 :y 86.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 282.0 :y 91.0) :end_control_point (:@type "point" :x 284.0 :y 95.0) :end_point (:@type "point" :x 291.0 :y 101.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 292.0 :y 102.0) :end_control_point (:@type "point" :x 293.0 :y 106.0) :end_point (:@type "point" :x 294.0 :y 104.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 304.0 :y 91.0) :end_control_point (:@type "point" :x 279.0 :y 67.0) :end_point (:@type "point" :x 334.0 :y 78.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 346.0 :y 80.0) :end_control_point (:@type "point" :x 335.0 :y 114.0) :end_point (:@type "point" :x 338.0 :y 121.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 342.0 :y 126.0) :end_control_point (:@type "point" :x 367.0 :y 151.0) :end_point (:@type "point" :x 367.0 :y 151.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 369.0 :y 160.0) :end_control_point (:@type "point" :x 371.0 :y 166.0) :end_point (:@type "point" :x 377.0 :y 174.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 384.0 :y 182.0) :end_control_point (:@type "point" :x 394.0 :y 189.0) :end_point (:@type "point" :x 399.0 :y 200.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 403.0 :y 207.0) :end_control_point (:@type "point" :x 403.0 :y 219.0) :end_point (:@type "point" :x 402.0 :y 227.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 400.0 :y 277.0) :end_control_point (:@type "point" :x 377.0 :y 243.0) :end_point (:@type "point" :x 358.0 :y 257.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 354.0 :y 259.0) :end_control_point (:@type "point" :x 360.0 :y 281.0) :end_point (:@type "point" :x 356.0 :y 287.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 350.0 :y 298.0) :end_control_point (:@type "point" :x 336.0 :y 294.0) :end_point (:@type "point" :x 340.0 :y 313.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 342.0 :y 319.0) :end_control_point (:@type "point" :x 352.0 :y 322.0) :end_point (:@type "point" :x 352.0 :y 329.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 350.0 :y 363.0) :end_control_point (:@type "point" :x 359.0 :y 384.0) :end_point (:@type "point" :x 365.0 :y 418.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 368.0 :y 436.0) :end_control_point (:@type "point" :x 366.0 :y 455.0) :end_point (:@type "point" :x 370.0 :y 473.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 371.0 :y 476.0) :end_control_point (:@type "point" :x 378.0 :y 510.0) :end_point (:@type "point" :x 375.0 :y 512.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 371.0 :y 514.0) :end_control_point (:@type "point" :x 354.0 :y 512.0) :end_point (:@type "point" :x 349.0 :y 512.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 345.0 :y 512.0) :end_control_point (:@type "point" :x 326.0 :y 515.0) :end_point (:@type "point" :x 323.0 :y 513.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 321.0 :y 511.0) :end_control_point (:@type "point" :x 299.0 :y 441.0) :end_point (:@type "point" :x 294.0 :y 432.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 291.0 :y 426.0) :end_control_point (:@type "point" :x 282.0 :y 392.0) :end_point (:@type "point" :x 279.0 :y 403.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 273.0 :y 428.0) :end_control_point (:@type "point" :x 268.0 :y 457.0) :end_point (:@type "point" :x 268.0 :y 483.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 268.0 :y 485.0) :end_control_point (:@type "point" :x 271.0 :y 512.0) :end_point (:@type "point" :x 270.0 :y 513.0)) (:@type "vectorPathCommandCubicBezierCurve" :start_control_point (:@type "point" :x 267.0 :y 515.0) :end_control_point (:@type "point" :x 250.0 :y 513.0) :end_point (:@type "point" :x 247.0 :y 513.0)) (:@type "vectorPathCommandLine" :end_point (:@type "point" :x 246.0 :y 512.0))])] :thumbnail (:@type "thumbnail" :format (:@type "thumbnailFormatWebp") :width 320 :height 320 :file (:@type "file" :id 2353 :size 13818 :expected_size 13818 :local (:@type "localFile" :path "/home/andrew/.telega/thumbnails/5251394021045062413_109.webp" :can_be_downloaded t :can_be_deleted t :is_downloading_active nil :is_downloading_completed t :download_offset 0 :downloaded_prefix_size 13818 :downloaded_size 13818) :remote (:@type "remoteFile" :id "AAMCAgADGQEAAQX-SmZXZep7-PyJHVG4t-oUGZPCAAGcawACDUsAAgqz4EgmuypvxlN2tAEAB20AAzUE" :unique_id "AQADDUsAAgqz4Ehy" :is_uploading_active nil :is_uploading_completed t :uploaded_size 13818) :telega-file-recency 1717004267)) :sticker (:@type "file" :id 2354 :size 24874 :expected_size 24874 :local (:@type "localFile" :path "/home/andrew/.telega/stickers/5251394021045062413.webp" :can_be_downloaded t :can_be_deleted t :is_downloading_active nil :is_downloading_completed t :download_offset 0 :downloaded_prefix_size 24874 :downloaded_size 24874) :remote (:@type "remoteFile" :id "CAACAgIAAxkBAAEF_kpmV2Xqe_j8iR1RuLfqFBmTwgABnGsAAg1LAAIKs-BIJrsqb8ZTdrQ1BA" :unique_id "AgADDUsAAgqz4Eg" :is_uploading_active nil :is_uploading_completed t :uploaded_size 24874) :telega-file-recency 1717004267) :telega-image (image :type png :file "/home/andrew/.telega/stickers/5251394021045062413_telega.png" :height (4.923076923076923 . em) :telega-nslices 4 :scale 1.0 :ascent center :transform-smoothing t :background "#1E2029")) :is_premium nil))))
      (spy-on 'write-region :and-call-through)
			(expect (telega--tl-get msg :content :sticker :sticker :remote :id) :to-equal "CAACAgIAAxkBAAEF_kpmV2Xqe_j8iR1RuLfqFBmTwgABnGsAAg1LAAIKs-BIJrsqb8ZTdrQ1BA")
      (telega-if-kappa-send-sticker msg)
      (expect 'write-region :to-have-been-called)
			)
		)
	)
